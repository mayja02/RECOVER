var map,baseLyrs,FireSeverity,FireLine,FireRecords,fireAffectedVegetation,startExtent,popup,geometryService,startExtent,toc,visible=[0],layers=[],widgets;!function(){function e(){$(".loading-indicator").remove()}require(["esri/map","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/SpatialReference","esri/tasks/GeometryService","esri/geometry/webMercatorUtils","esri/geometry/Extent","esri/geometry/scaleUtils","esri/renderers/SimpleRenderer","esri/renderers/ClassBreaksRenderer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/Color","esri/dijit/Scalebar","esri/dijit/Popup","esri/dijit/OverviewMap","esri/dijit/Basemap","esri/dijit/BasemapGallery","dojo/_base/connect","dojo/on","dojo/query","dojo/_base/array","agsjs/dijit/TOC","dojo/dnd/move","dojo/dom","dojo/dom-construct","dojo/parser","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojo/domReady!"],function(e,t,o,r,i,a,n,s,l,c,d,p,m,u,y,g,h,f,b,S,w,v,E,T,I,L,C){function M(e){var t=a.webMercatorToGeographic(e.mapPoint);I.byId("info").innerHTML="Latitude: "+t.x.toFixed(3)+", Longitude: "+t.y.toFixed(3)}function A(){var e=new f({showArcGISBasemaps:!0,map:map},"basemapGallery");e.startup(),e.on("error",function(e){console.log("basemap gallery error:  ",e)})}function _(){visible=[];for(var e=0;e<toc.layerInfos[3].layer._tocInfos.length;e++){var t=toc.layerInfos[3].layer._tocInfos[e];t.visible===!0&&visible.push(t.id)}}C.parse(),geometryService=new i("http://recover.giscenter.isu.edu/arcgis/rest/services/Utilities/Geometry/GeometryServer"),esriConfig.defaults.geometryService="http://recover.giscenter.isu.edu/arcgis/rest/services/Utilities/Geometry/GeometryServer",widgets.forEach(function(e){new T.parentConstrainedMoveable(e.widget,{handle:e.handle,area:map,within:!0,delay:"20px"});e.handle.addEventListener("mousedown",function(){$(this).parent().css("opacity","0.6")}),e.handle.addEventListener("mouseup",function(){$(this).parent().css("opacity","1")})}),window.onkeydown=function(e){if(console.log(e.keyCode),112===e.keyCode){var t=window.open("http://giscenter.isu.edu/research/Techpg/nasa_RECOVER/index.htm","_blank");t?t.focus():alert("Please allow popups for this website")}},startExtent=esri.geometry.Extent(-12692442.57378805,5316630.715935899,-12496763.781377923,5389245.892806845,new r({wkid:102100})),map=new e("map",{extent:startExtent,zoom:10,basemap:"satellite",infoWindow:popup}),window.map=map,baseLyrs=new o("http://fuji.giscenter.isu.edu/arcgis/rest/services/RECOVER_crystalFire_ID/basemap/MapServer"),FireSeverity=new t("http://services1.arcgis.com/z5tlnpYHokW9isdE/arcgis/rest/services/RECOVER_RT/FeatureServer/0"),FireLine=new t("http://services1.arcgis.com/z5tlnpYHokW9isdE/arcgis/rest/services/RECOVER_RT/FeatureServer/2"),FireRecords=new t("http://services1.arcgis.com/z5tlnpYHokW9isdE/arcgis/rest/services/RECOVER_RT/FeatureServer/1"),map.on("load",function(){map.addLayers([FireSeverity,FireRecords,FireLine,baseLyrs])}),layers.push(baseLyrs),map.on("layers-add-result",function(e){toc=new E({map:map,layerInfos:[{layer:FireSeverity,title:"Fire Severity",slider:!0,collapsed:!0},{layer:FireRecords,title:"Fire Records",slider:!0,collapsed:!0},{layer:FireLine,title:"Fire Line",slider:!0,collapsed:!0},{layer:baseLyrs,title:"RECOVER Base Layers",collapsed:!0,slider:!0}]},"tocDiv"),toc.startup()}),$("#tocDiv").on("change",_),popup=new y({fillSymbol:new d(d.STYLE_SOLID,new p(p.STYLE_SOLID,new m([255,0,0]),2),new m([255,255,0,.25]))},L.create("div"));new u({map:map,scalebarUnit:"dual"});A();var R=new g({map:map,attachTo:"bottom-right",color:"#F20C0C",opacity:.4});R.startup(),map.on("load",function(){map.graphics.graphics.pop(),map.on("mouse-move",M),map.on("mouse-drag",M)})}),$("#map").ready(function(){setInterval(e,1500)}),$(document).ready(function(){$("#GSCCModal").modal({backdrop:"static"}),$("#GSCCModal").css({display:"block"})}),$("#close_modal").on("click",function(){$("body").removeClass("modal-open"),$(".modal-backdrop.in").remove(),$("#GSCCModal").remove()}),widgets=[{name:"LayerList",icon:$("#LyrListImg"),widget:document.getElementById("LyrWidget"),handle:document.getElementById("LyrListTitle")},{name:"Swipe",icon:$("#SwipeImg"),widget:document.getElementById("SwipeWidget"),handle:document.getElementById("SwipeTitle")},{name:"Draw",icon:$("#DrawImg"),widget:document.getElementById("DrawWidget"),handle:document.getElementById("DrawTitle")},{name:"Bookmarks",icon:$("#BookmarkImg"),widget:document.getElementById("BookmarksWidget"),handle:document.getElementById("BookmarkTitle")},{name:"Shapefile",icon:$("#ShpImg"),widget:document.getElementById("ShpWidget"),handle:document.getElementById("ShpfileTitle")},{name:"Print",icon:$("#PrintImg"),widget:document.getElementById("PrintWidget"),handle:document.getElementById("PrintTitle")}],widgets.forEach(function(e){e.icon.on("click",function(){$(this).toggleClass("selected"),$(this).animate({bottom:"10px"},200),$(this).animate({bottom:"0px"},200),e.icon.hasClass("selected")?e.widget.style.display="block":e.widget.style.display="none"}),$(e.widget).on("click","button.remove",function(){$(this).closest(".widget_container").hide(),e.icon.removeClass("selected")}).removeClass("selected"),$(e.widget).on("click","button.minimize",function(){var e=$(this).closest(".widget_container");e.toggleClass("minimized"),e.hasClass("minimized")?$(this).find("img").attr("src","assets/images/w_down.png"):$(this).find("img").attr("src","assets/images/w_min.png")})})}(),function(){require(["esri/InfoTemplate","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","dojo/_base/array","dojo/domReady!"],function(e,t,o,r){function i(){$("#DrawImg").hasClass("selected")===!0?(s.returnGeometry=!1,$(".esriPopup").hide()):(map.on("click",a),s.layerIds=visible,s.layerOption=o.LAYER_OPTION_ALL,s.tolerance=3,s.width=map.width,s.height=map.height,s.returnGeometry=!0,$(".esriPopup").show())}function a(t){s.geometry=t.mapPoint,s.mapExtent=map.extent;var o=n.execute(s).addCallback(function(t){return r.map(t,function(t){var o=t.feature,r=t.layerName;if(o.attributes.layerName=r,"Fire Boundary"===r){var i=new e("Fire Boundary","Fire Number: ${FIRE_NUMBE}<br>Year: ${YEAR_}");o.setInfoTemplate(i)}if("Roads"===r){var a=new e("Roads","Class: ${ROAD_CL}<br>Length: ${Shape_Length}");o.setInfoTemplate(a)}if("NHD (National Hydrography Dataset)"===r){var n=new e("Hydrography","FCode: ${FCode}<br>Feature Type: ${FType}<br>Length: ${Shape_Length}");o.setInfoTemplate(n)}if("Habitat"===r){var s=new e("Habitat","Notes: ${Notes}<br>Species: ${Species}<br>Area (sq. Meters): ${SHAPE_Area}");o.setInfoTemplate(s)}if("WatershedsWBD"===r){var l=new e("Watershed Boundary","Name: ${Watershed Name}<br>Acres: ${Acres}<br>");o.setInfoTemplate(l)}if("Wetlands"===r){var c=new e("Wetlands","Type: ${WetlandType}<br>Length (meters): ${Shape_Length}<br>Area (sq. meters): ${Shape_area}<br>Acres: ${ACRES}");o.setInfoTemplate(c)}if("PLSS"===r){var d=new e("PLSS","Identifier: ${FRSTDIVID}<br>State: ${STATE}<br>Section: ${DivNumber}<br>Type: ${DivType}<br>Township: ${TOWNSHIP}<br>Range: ${RANGE}");o.setInfoTemplate(d)}if("SMA (Surface Management Agency)"===r){var p=new e("Surface Management Agency","Admin Department: ${Administration Department}<br>Admin Agency: ${Administration Agency}<br>Unit Name: ${Admin. Unit Name}");o.setInfoTemplate(p)}if("Geology"===r){var m=new e("Geology","State: ${STATE}<br>Age: ${UNIT_AGE}<br>LITH62: ${LITH62}<br>LITH62MINO: ${LITH62MINO}<br><br> Attachment:<br><a href=${URL} target=_blank>Site Description Report</a");o.setInfoTemplate(m)}if("Soils_STATSGO"===r){var u=new e("Soils STATSGO","Map Unit Symbol: ${MUSYM}<br>MUKEY: ${MUKEY}<br><br>Attachment:<br><a href=${URL} target=_blank>Range Report</a>");o.setInfoTemplate(u)}if("Soils_SSURGO"===r){var y=new e("Soils SSURGO","Area Symbol: ${AREASYMBOL}<br>Map Unit Symbol: ${MUSYM}<br><br>Attachment:<br><a href=${URL} target=_blank>Plant Association Report</a>");o.setInfoTemplate(y)}if("Landslide Potential"===r){var g=new e("Landslide Potential","Susceptibility: ${INC_SUS}");o.setInfoTemplate(g)}if("Fires 1950-Present"===r){var h=new e("Fires 1950-Present","Name: ${FIRE_NAME}<br>Year: ${FIRE_YEAR}<br>Acres: ${Acres}");o.setInfoTemplate(h)}if("Elevation"===r){var f=new e("Elevation","Value (Meters): ${Pixel Value}");o.setInfoTemplate(f)}if("Slope (Degrees)"===r){var b=new e("Slope (Degrees)","Value: ${Pixel Value}");o.setInfoTemplate(b)}if("Slope (Percent)"===r){var S=new e("Slope (Percent)","Value: ${Pixel Value}");o.setInfoTemplate(S)}if("Aspect"===r){var w=new e("Aspect","Value: ${Pixel Value}");o.setInfoTemplate(w)}if("FRG (Fire Regime Group)"===r){var v=new e("FRG (Fire Regime Group)","Label: ${Label}<br>Description: ${Descriptio}");o.setInfoTemplate(v)}if("EVC (Existing Vegetation Coverage)"===r){var E=new e("EVC (Existing Vegetation Coverage)","Class: ${CLASSNAMES}");o.setInfoTemplate(E)}if("EVT (Existing Vegetation Type)"===r){var T=new e("EVT (Existing Vegetation Type)","Class Name: ${CLASSNAME}<br>EVT Phys: ${EVT_PHYS}<br>System Group Name: ${EVT_GP_N}<br>SAF SRM: ${SAF_SRM}<br>EVT Order: ${EVT_ORDER}<br>EVT Subclass: ${EVT_SBCLS}");o.setInfoTemplate(T)}if("ESP (Environmental Site Potential)"===r){var I=new e("ESP (Environmental Site Potential)","Zone: ${ZONE_NAME}<br>ESP NAME: ${ESP_Name}<br>ESPLF NAME: ${ESPLF_Name}");o.setInfoTemplate(I)}if("BPS (Biophysical Setting)"===r){var L=new e("BPS (Biophysical Setting)","NAME: ${BPS_NAME}<br>Group Name: ${GROUPNAME}<br>Group Vegetation Type: ${GROUPVEG}");o.setInfoTemplate(L)}return o})});map.infoWindow.setFeatures([o]),map.infoWindow.show(t.mapPoint)}var n=new t("http://fuji.giscenter.isu.edu/arcgis/rest/services/RECOVER_crystalFire_ID/basemap/MapServer"),s=new o;$("#map").on("click",i),$("#CloseDrawWidget").on("click",function(){$(".esriPopup .titleButton.close").click()})})}(),function(){require(["esri/dijit/BookmarkItem","esri/dijit/Bookmarks","dojo/dom","dojo/domReady!"],function(e,t,o,r){function i(){var e=[{extent:startExtent,name:"Crystal Fire"}];new t({map:map,bookmarks:e,editable:!0},dojo.byId("Bookmarks"))}dojo.ready(i)})}(),function(){require(["esri/dijit/LayerSwipe","dojo/_base/array","esri/arcgis/utils","dojo/dom","dojo/on","dojo/domReady!"],function(e,t,o,r,i){function a(){s.destroy(),$("#map").prepend(n),$(".esriSimpleSlider").show()}var n=document.createElement("div");n.id="swipeDiv";var s,l=screen.width/2;$("#SwipeImg").on("click",function(){$("#SwipeImg").hasClass("selected")===!0?(s=new e({theme:"LayerSwipe",type:"vertical",map:map,layers:layers,left:l,invertPlacement:!0},"swipeDiv"),s.startup(),$(".esriSimpleSlider").hide(),$(".esriPopup").hide()):a()}),$("#CloseSwipeWidget").on("click",a),i(r.byId("toggleVertical"),"click",function(e){s.set("type","vertical"),$(".LayerSwipe").css("top","0")}),i(r.byId("toggleHorizontal"),"click",function(e){s.set("type","horizontal"),$(".LayerSwipe").css("top","auto")})})}();var editToolbar,ctxMenuForGraphics,ctxMenuForMap,buttonclick,selected,currentLocation,PolyArea,measureUnit,symbol,Lat,Long,linelength,selectedTrans,graphic,point2,curcount;!function(){define("myModules/CustomOperation",["dojo/_base/declare","esri/OperationBase","esri/toolbars/navigation"],function(e,t,o){var r={};return r.Add=e(t,{label:"Add Graphic",constructor:function(e){return e=e||{},e.graphicsLayer?(this.graphicsLayer=e.graphicsLayer,e.addedGraphic?void(this._addedGraphic=e.addedGraphic):void console.error("no graphics provided")):void console.error("graphicsLayer is not provided")},performUndo:function(){this.graphicsLayer.remove(this._addedGraphic)},performRedo:function(){this.graphicsLayer.add(this._addedGraphic)}}),r}),require(["dojo/parser","dijit/form/CheckBox","esri/toolbars/draw","dojo/on","dojo/dom","dijit/registry","dojo/_base/Color","esri/graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dijit/form/NumberSpinner","esri/toolbars/edit","esri/geometry/jsonUtils","dijit/Menu","dijit/MenuItem","dijit/MenuSeparator","esri/geometry/Point","dijit/form/TextBox","esri/undoManager","myModules/CustomOperation","dojo/data/ObjectStore","dojo/store/Memory","esri/geometry/webMercatorUtils","esri/SpatialReference","dojo/dom-construct","dojo/_base/connect","esri/symbols/Font","esri/symbols/TextSymbol","dojo/dom-style","dijit/popup","dojo/number","esri/tasks/LengthsParameters","esri/tasks/GeometryService","esri/tasks/AreasAndLengthsParameters","dojo/_base/array","esri/config","dijit/form/HorizontalSlider","dijit/form/Select","dijit/PopupMenuItem","dijit/ColorPalette","dojo/query","dojo/json","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/AccordionContainer","dijit/form/Button","dijit/form/ToggleButton","dojo/domReady!"],function(e,t,o,r,i,a,n,s,l,c,d,p,m,u,y,g,h,f,b,S,w,v,E,T,I,L,C,M,A,_,R,x,F,j,k,G,$,P,D,U,N,O,B){function Y(){ctxMenuForMap=new y({onOpen:function(e){currentLocation=V(e),editToolbar.deactivate()}}),ctxMenuForMap.addChild(new g({label:"Add Text",onClick:function(e){var t=new A(he).setColor(new n(ge)).setAlign(M.ALIGN_START).setAngle(0).setDecoration(se).setFont(new M(de).setWeight(ne).setStyle(le)),o=new f(u.fromJson(currentLocation.toJson())),r=new s(o,t);map.graphics.add(r)}})),ctxMenuForMap.startup()}function H(){ctxMenuForGraphics=new y({});var e=new g({label:"Edit",onClick:function(){"point"!==selected.geometry.type?editToolbar.activate(m.EDIT_VERTICES,selected):editToolbar.activate(m.MOVE|m.EDIT_VERTICES|m.EDIT_TEXT|m.SCALE,selected)}}),t=new g({label:"Move",onClick:function(){editToolbar.activate(m.MOVE,selected)}}),o=new g({label:"Rotate/Scale",onClick:function(){editToolbar.activate(m.ROTATE|m.SCALE,selected)}}),r=new g({label:"Add Lat/Long",onClick:function(){var e=selected.geometry,t=T.webMercatorToGeographic(e),o=x.format(t.y,{places:5}),r=x.format(t.x,{places:5}),i=new A("Lat: "+o+", Long: "+r).setColor(new n(ge)).setAlign(M.ALIGN_MIDDLE).setAngle(0).setDecoration(se).setOffset(5,5).setFont(new M(de).setWeight(ne).setStyle(le)).setHaloSize(1).setHaloColor(new n("[255,255,255]")),a=new s(t,i);map.graphics.add(a)}});ctxMenuForGraphics.addChild(r);var i=new P({name:"slider",id:"TransPop",value:0,minimum:0,maximum:.99,style:"width:150px",onChange:function(e){var t=1-e,o=selected.symbol.color.r,r=selected.symbol.color.g,i=selected.symbol.color.b,a=[o,r,i,t];if("polygon"==selected.geometry.type){"solid"==selected.symbol.style?symbolfill2=d.STYLE_SOLID:symbolfill2=d.STYLE_NULL;var s=selected.symbol.outline.width,p=new d(symbolfill2,new c(c.STYLE_SOLID,new n(a),s),new n(a));selected.setSymbol(p)}else if("textsymbol"==selected.symbol.type){var m=selected.symbol.angle,u=selected.symbol.text,p=new A(u).setColor(new n(a)).setAlign(M.ALIGN_START).setAngle(0).setDecoration(se).setFont(new M(de).setWeight(ne).setStyle(le)).setHaloSize(1).setHaloColor(new n("[255,255,255]"));p.setAngle(m),selected.setSymbol(p)}else if("polyline"==selected.geometry.type){var y=selected.symbol.width,g=new c(c.STYLE_SOLID,new n(a),y);selected.setSymbol(g)}else if("circle"==selected.symbol.style){var h=selected.symbol.size,p=new l(l.STYLE_CIRCLE,h,new c(c.STYLE_SOLID,new n(a),1),new n(a));selected.setSymbol(p)}}}),a=new U({label:"Transparency",popup:i}),p=new D({name:"select2",options:[{label:"Select Measurement",value:"SELECT",selected:!0},{label:"Feet",value:"FEET"},{label:"Miles",value:"MILES"},{label:"Meters",value:"METERS"},{label:"Kilometers",value:"KILO"},{label:"Yards",value:"YARDS"},{label:"Acres",value:"ACRES"}]});p.startup(),p.on("change",function(e){if(measureUnit=e,"FEET"==e)Ee=j.UNIT_SQUARE_FEET,Te=j.UNIT_FOOT,Ie=" sq. feet",Le=" feet";else if("MILES"==e)Ee=j.UNIT_SQUARE_MILES,Te=j.UNIT_STATUTE_MILE,Ie=" sq. miles",Le=" miles";else if("METERS"==e)Ee=j.UNIT_SQUARE_METERS,Te=j.UNIT_METER,Ie=" sq. meters",Le=" meters";else if("KILO"==e)Ee=j.UNIT_SQUARE_KILOMETERS,Te=j.UNIT_KILOMETER,Ie=" sq. kilometers",Le=" kilometers";else if("YARDS"==e)Ee=j.UNIT_SQUARE_YARDS,Te=j.UNIT_STATUTE_MILE,Ie=" sq. yards",Le=" yards";else{if("ACRES"!=e)return;Ee=j.UNIT_ACRES,Unite_L_Label="Acres"}if(ge=selected.symbol.color,"point"==selected.geometry.type){var t=selected.geometry,o=T.webMercatorToGeographic(t),r=x.format(o.y,{places:5}),i=x.format(o.x,{places:5}),a=new A("Lat: "+r+", Long: "+i).setColor(new n(ge)).setAlign(M.ALIGN_MIDDLE).setAngle(0).setDecoration(se).setOffset(5,5).setFont(new M(de).setWeight(ne).setStyle(le)).setHaloColor(new n([255,255,255])).setHaloSize(1),l=new s(o,a);map.graphics.add(l)}else if("polyline"==selected.geometry.type){var c=new F;c.lengthUnit=Te,c.polylines=[selected.geometry],c.geodesic=!0,map_y=selected.geometry.paths[0][0][1],map_x=selected.geometry.paths[0][0][0];var t=new f([map_x,map_y],new I({wkid:102100})),o=T.webMercatorToGeographic(t);Lat=o.y,Long=o.x,ve.lengths(c)}else if("polygon"==selected.geometry.type){"solid"==selected.symbol.style?polygonColor=[255,255,255]:polygonColor=selected.symbol.color;var d=new k;d.areaUnit=Ee,d.lengthUnit=Te,d.calculationType="geodesic",d.polygons=[selected.geometry],ve.simplify(d.polygons,ee),ve.areasAndLengths(d),p.set("value","SELECT")}});var u=new U({label:"Add Measurement",popup:p}),b=new h;ctxMenuForGraphics.addChild(b);var S=new g({label:"Delete",onClick:function(){var e=new w.Add({graphicsLayer:map.graphics,addedGraphic:selected});te.add(e),te.undo(),te.remove(curcount)}});ctxMenuForGraphics.startup(),map.graphics.on("mouse-over",function(i){ctxMenuForGraphics.addChild(e),ctxMenuForGraphics.addChild(t),ctxMenuForGraphics.addChild(o),ctxMenuForGraphics.addChild(a),ctxMenuForGraphics.addChild(u),ctxMenuForGraphics.addChild(b),ctxMenuForGraphics.addChild(S),selected=i.graphic,SelectedTrans=1-selected.symbol.color.a,dijit.byId("TransPop").set("value",SelectedTrans),"circle"==selected.symbol.style?(ctxMenuForGraphics.removeChild(e),ctxMenuForGraphics.removeChild(o),ctxMenuForGraphics.removeChild(u),ctxMenuForGraphics.removeChild(b),ctxMenuForGraphics.removeChild(a),ctxMenuForGraphics.removeChild(S),ctxMenuForGraphics.removeChild(t),ctxMenuForGraphics.addChild(t),ctxMenuForGraphics.addChild(r),ctxMenuForGraphics.addChild(a),ctxMenuForGraphics.addChild(b),ctxMenuForGraphics.addChild(S)):"textsymbol"==selected.symbol.type?(ctxMenuForGraphics.removeChild(u),ctxMenuForGraphics.removeChild(r)):ctxMenuForGraphics.removeChild(r),ctxMenuForGraphics.bindDomNode(i.graphic.getDojoShape().getNode())}),map.graphics.on("mouse-out",function(e){ctxMenuForGraphics.unBindDomNode(e.graphic.getDojoShape().getNode())})}function V(e){var t=e.x,o=e.y;switch(e.corner){case"TR":t+=e.w;break;case"BL":o+=e.h;break;case"BR":t+=e.w,o+=e.h}var r=new f(t-map.position.x,o-map.position.y);return map.toMap(r)}function W(e){if("Text"==this.id&&""!==he){var t="Click to add text",r=L.create("div",{"class":"tooltip",innerHTML:t},map.container);document.getElementById("GraphicHTML").innerHTML="ready to add text",_.set(r,"position","fixed");map.on("mouse-move",function(e){var t,o;e.clientX||e.pageY?(t=e.clientX,o=e.clientY):(t=e.clientX+win.body().scrollLeft-win.body().clientLeft,o=e.clientY+win.body().scrollTop-win.body().clientTop),r.style.display="none",_.set(r,{left:t+15+"px",top:o+"px"}),r.style.display=""});map.on("mouse-out",function(e){r.style.display="none"});var i=map.on("click",function(e){symbol=new A(he).setColor(new n(ge)).setAlign(M.ALIGN_START).setAngle(0).setDecoration(se).setFont(new M(de).setWeight(ne).setStyle(le)).setHaloSize(1).setHaloColor(new n("[255,255,255]")),point2=new f(e.mapPoint),graphic=new s(point2,symbol),z(),i.remove(),L.destroy(r)})}else{var a=this.id.toUpperCase().replace(/ /g,"_");toolbar.activate(o[a])}}function z(e){if(void 0===e)console.log("undefined");else{toolbar.deactivate();var t=Se.value;switch(""===t?ge=ge:Q(),e.geometry.type){case"point":case"multipoint":symbol=new l(l.STYLE_CIRCLE,ce,new c(c.STYLE_SOLID,new n(ge),1),new n(ge));break;case"polyline":symbol=new c(c.STYLE_SOLID,new n(ge),ce);break;default:symbol=new d(ae,new c(c.STYLE_SOLID,new n(ge),ce),new n(ge))}graphic=new s(e.geometry,symbol)}var o=new w.Add({graphicsLayer:map.graphics,addedGraphic:graphic});te.add(o),map.graphics.add(graphic)}function q(){ce=fe.get("value")}function K(){de=be.get("value")}function Q(){function e(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}hexColor=Se.value,_.set(dojo.byId("colorSwatch"),{backgroundColor:Se.value}),R.close(a.byId("colorPaletteDialog")),me=e(hexColor).r,ue=e(hexColor).g,ye=e(hexColor).b,ge=[me,ue,ye,pe]}function J(){he=we.get("value")}function X(){graphicsList=[],buttonclick.remove(),map.graphics.clear(),te.clearRedo(),te.clearUndo()}function Z(e){if("point"==e.geographicGeometry.type){var t=x.format(e.geographicGeometry.y,{places:5}),o=x.format(e.geographicGeometry.x,{places:5}),r=e.geometry,i=new A("Lat: "+t+", Long: "+o).setColor(new n(ge)).setAlign(M.ALIGN_MIDDLE).setAngle(0).setDecoration(le).setOffset(5,5).setFont(new M(de).setWeight(ne).setStyle(le)).setHaloColor(new n("[255,255,255]")).setHaloSize(1),a=new s(r,i);map.graphics.add(a)}else if("polyline"==e.geographicGeometry.type){var l=new F;l.lengthUnit=Te,l.polylines=[e.geometry],l.geodesic=!0,ve.lengths(l),Lat=e.geographicGeometry.paths[0][0][1],Long=e.geographicGeometry.paths[0][0][0]}else if("polygon"==e.geographicGeometry.type){dijit.byId("FillcheckBox").get("checked")?polygonColor=[255,255,255]:dijit.byId("FillcheckBox").get("checked")!==!0&&(polygonColor=ge);var c=new k;c.areaUnit=Ee,c.lengthUnit=Te,c.polygons=[e.geometry],ve.simplify(c.polygons,ee),ve.areasAndLengths(c)}else alert("In developement!")}function ee(e){ve.labelPoints(e,function(e){G.forEach(e,function(e){var t=new M(de).setWeight(ne),o=new A(PolyArea+Ie,t,new n(polygonColor)).setHaloSize(1).setHaloColor(new n("[255,255,255]")),r=new s(e,o);map.graphics.add(r)})})}e.parse();var te=new S;a.byId("undo").on("click",function(){te.undo(),console.log("The current position is: "+te.position)}),a.byId("redo").on("click",function(){te.redo(),console.log("The current position is: "+te.position)});var oe=O("#saveGraphic");oe.on("click",function(){console.log("saving graphics");var e="{",t=map.graphics.graphics;t.forEach(function(t,o,r){var i=typeof t,a={};a.geometry=t.geometry,a.symbol=t.symbol,console.log(t,i),console.log(t.symbol);B.stringify(t.toJson());e+='"'+o+'":'+dojo.toJson(t.toJson())+","}),e=e.substring(0,e.length-1),e+="}",console.log(e);var o=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(o),i=document.getElementById("graphicDownload");i.download="graphics.json",i.href=r});var re=O("#file-input");re.on("change",function(e){if(window.FileReader){var t=new FileReader;t.onload=function(e){if(2==e.target.readyState){if(e.target.error)return void alert("Errorwhile reading file");var t=B.parse(e.target.result);for(var o in t){console.log(o),console.log(t[o]);var r=new s(t[o]);map.graphics.add(r)}re.value=e.target.result}},t.readAsText(e.target.files[0]),console.log(" a json file has been uploaded"),re.value=""}});var ie=i.byId("DrawImg");r(ie,"click",function(){function e(){dijit.byId("TransPop").destroy(),ctxMenuForMap.unBindDomNode(map.container),ctxMenuForGraphics.destroy()}dojo.hasClass(ie,"selected")===!0?(toolbar=new o(map),r(toolbar,"draw-end",z),editToolbar=new m(map),map.on("click",function(e){editToolbar.deactivate()}),Y(),H(),ctxMenuForMap.bindDomNode(map.container)):e(),O("#CloseDrawWidget").on("click",e)});var ae=d.STYLE_NULL,ne=M.WEIGHT_BOLD,se="none",le=M.STYLE_NORMAL,ce=3,de=12,pe=1,me=0,ue=0,ye=0,ge=[me,ue,ye,pe],he="";a.forEach(function(e){"dijit.form.Button"===e.declaredClass&&(buttonclick=e.on("click",W))});var fe=(new t({name:"FillcheckBox",value:"agreed",checked:!1,onChange:function(e){ae=e===!0?d.STYLE_SOLID:d.STYLE_NULL}},"FillcheckBox").startup(),new t({name:"MeasCheckBox",value:"agreed",checked:!1,onChange:function(e){e===!0?MeasureDo=toolbar.on("draw-complete",Z):MeasureDo.remove()}},"MeasCheckBox").startup(),new p({value:3,smallDelta:1,constraints:{min:1,max:100,places:0},id:"integerspinner3",style:"width:40px"},"spinnerId1"));r(fe,"change",q);var be=new p({value:12,smallDelta:1,constraints:{min:1,max:100,places:0},id:"integerspinner4",style:"width:45px"},"spinnerId2");r(be,"change",K),r(dijit.byId("bold"),"change",function(e){ne=e===!0?M.WEIGHT_BOLDER:M.WEIGHT_BOLD}),r(dijit.byId("underline"),"change",function(e){se=e===!0?"underline":"none"}),r(dijit.byId("italic"),"change",function(e){le=e===!0?M.STYLE_ITALIC:M.STYLE_NORMAL});var Se=a.byId("colorPaletteWidget");r(a.byId("colorPaletteWidget"),"change",Q),Se.set("value","#000000"),currentTrans=new P({name:"TransSlider",value:0,minimum:0,maximum:.99,intermediateChanges:!0,style:"width:130px",onChange:function(e){i.byId("slider1input").value=dojo.number.format(e,{places:0,pattern:"#%"}),pe=1-e,ge=[me,ue,ye,pe]}},"TransSlider").startup();var we=a.byId("value0Box");r(we,"change",J),r(a.byId("clear"),"click",X);var ve=new j("http://recover.giscenter.isu.edu/arcgis/rest/services/Utilities/Geometry/GeometryServer"),Ee=j.UNIT_ACRES,Te=j.UNIT_FOOT,Ie=" acres",Le=" feet";ve.on("lengths-complete",function(e){"YARDS"==measureUnit?(linelengthInt=e.result.lengths[0],linelength=x.format(1760*linelengthInt,{places:2})):linelength=x.format(e.result.lengths[0],{places:2}),labelPoint=new f(Long,Lat),textSymbol=new A(linelength+Le).setColor(new n(ge)).setAlign(M.ALIGN_MIDDLE).setAngle(0).setDecoration(le).setOffset(5,5).setFont(new M(de).setWeight(ne).setStyle(le)).setHaloSize(1).setHaloColor(new n("[255,255,255]")),labelPointGraphic=new s(labelPoint,textSymbol),map.graphics.add(labelPointGraphic)}),ve.on("areas-and-lengths-complete",function(e){PolyArea=x.format(e.result.areas[0],{places:2})});var Ce=new E({data:[{id:"FEET",label:"Feet"},{id:"MILES",label:"Miles"},{id:"METERS",label:"Meters"},{id:"YARDS",label:"Yards"},{id:"KILO",label:"Kilometers"},{id:"ACRES",label:"Acres"}]}),Me=new v({objectStore:Ce}),Ae=new D({store:Me},"units");Ae.startup(),Ae.on("change",function(e){measureUnit=e,"FEET"==e?(Ee=j.UNIT_SQUARE_FEET,Te=j.UNIT_FOOT,Ie=" sq. feet",Le=" feet"):"MILES"==e?(Ee=j.UNIT_SQUARE_MILES,Te=j.UNIT_STATUTE_MILE,Ie=" sq. miles",Le=" miles"):"METERS"==e?(Ee=j.UNIT_SQUARE_METERS,Te=j.UNIT_METER,Ie=" sq. meters",Le=" meters"):"KILO"==e?(Ee=j.UNIT_SQUARE_KILOMETERS,Te=j.UNIT_KILOMETER,Ie=" sq. kilometers",Le=" kilometers"):"YARDS"==e?(Ee=j.UNIT_SQUARE_YARDS,Te=j.UNIT_STATUTE_MILE,Ie=" sq. yards",Le=" yards"):"ACRES"==e&&(Ee=j.UNITE_ACRES,Unite_L_Label="Acres")}),C.connect(te,"onChange",function(){te.canUndo?a.byId("undo").set("disabled",!1):a.byId("undo").set("disabled",!0),te.canRedo?a.byId("redo").set("disabled",!1):a.byId("redo").set("disabled",!0)})})}(),function(){require(["esri/config","esri/InfoTemplate","esri/map","esri/request","esri/geometry/scaleUtils","esri/layers/FeatureLayer","esri/renderers/SimpleRenderer","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","dojo/dom","dojo/json","dojo/on","dojo/parser","dojo/sniff","dojo/_base/array","esri/Color","dojo/_base/lang","dijit/layout/BorderContainer","dijit/layout/ContentPane","dojo/domReady!"],function(e,t,o,r,i,a,n,s,l,c,d,p,m,u,y,g,h,f){function b(e){function o(e){d.byId("upload-status").innerHTML="<p style='color:red'>"+e.message+"</p>"}function m(e){var o;g.forEach(e.layers,function(e){var r=new t("Details","${*}"),i=new a(e,{infoTemplate:r});i.on("click",function(e){map.infoWindow.setFeatures([e.graphic])}),u(i),o=o?o.union(i.fullExtent):i.fullExtent,layers.push(i)}),map.addLayers(layers),map.setExtent(o.expand(1.25),!0),d.byId("upload-status").innerHTML=""}function u(e){var t=null;switch(e.geometryType){case"esriGeometryPoint":t=new s({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Shapes/BluePin1LargeB.png",contentType:"image/png",width:20,height:20});break;case"esriGeometryPolygon":t=new l(l.STYLE_SOLID,new c(c.STYLE_SOLID,new h([255,0,0]),4),new h([255,255,255,.5]))}t&&e.setRenderer(new n(t))}var y=e.split(".");y=y[0].replace("c:\\fakepath\\",""),d.byId("upload-status").innerHTML="<b>Loading </b>"+y;var b={name:y,targetSR:map.spatialReference,maxRecordCount:1e3,enforceInputFileSizeLimit:!0,enforceOutputJsonSizeLimit:!0},w=i.getExtentForScale(map,4e4),v=w.getWidth()/map.width;b.generalize=!0,b.maxAllowableOffset=v,b.reducePrecision=!0,b.numberOfDigitsAfterDecimal=0;var E={filetype:"shapefile",publishParameters:p.stringify(b),f:"json"};r({url:S+"/sharing/rest/content/features/generate",content:E,form:d.byId("uploadForm"),handleAs:"json",load:f.hitch(this,function(e){if(e.error)return void o(e.error);var t=e.featureCollection.layers[0].layerDefinition.name;d.byId("upload-status").innerHTML="<b>Loaded: </b>"+t,m(e.featureCollection)}),error:f.hitch(this,o)})}u.parse();var S="http://www.arcgis.com";m(d.byId("uploadForm"),"change",function(e){var t=e.target.value.toLowerCase();if(y("ie")){var o=t.split("\\");t=o[o.length-1]}-1!==t.indexOf(".zip")?b(t):d.byId("upload-status").innerHTML='<p style="color:red">Add shapefile as .zip file</p>'})})}(),function(){var e={};require(["esri/config","esri/tasks/GeometryService","esri/tasks/PrintTask","esri/tasks/PrintParameters","esri/tasks/PrintTemplate","dojo/_base/array","dojo/dom","dojo/on","dojo/parser","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dijit/form/CheckBox","dojo/domReady!"],function(t,o,r,i,a,n,s,l,c){function d(t,o){var n=new a;n.layout=document.getElementById("printLayoutId").value,n.format=document.getElementById("printFormatId").value,n.layoutOptions={titleText:t,authorText:o};var s=new i;s.map=map,s.template=n;var l=new r(e.printUrl),c={printTask:l,params:s};return c}e.printUrl="http://fuji.giscenter.isu.edu/arcgis/rest/services/RECOVER/ExportWebMap/GPServer/Export%20Web%20Map",l(s.byId("btnPrintReady"),"click",function(){document.getElementById("btnPrintReady").innerHTML="Printing...",document.getElementById("btnPrintReady").disabled=!0;var e=d(document.getElementById("printTitleId").value,document.getElementById("printAuthor").value),t=e.printTask;t.execute(e.params,function(e){window.open(e.url),document.getElementById("btnPrintReady").innerHTML="Print",document.getElementById("btnPrintReady").disabled=!1})})})}();