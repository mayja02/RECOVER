var map,baseLyrs,FireSeverity,FireLine,FireRecords,fireAffectedVegetation,startExtent,popup,geometryService,startExtent,toc,visible=[0],layers=[],widgets;!function(){function e(){$(".loading-indicator").remove()}require(["esri/map","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/SpatialReference","esri/tasks/GeometryService","esri/geometry/webMercatorUtils","esri/geometry/Extent","esri/geometry/scaleUtils","esri/renderers/SimpleRenderer","esri/renderers/ClassBreaksRenderer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/Color","esri/dijit/Scalebar","esri/dijit/Popup","esri/dijit/OverviewMap","esri/dijit/Basemap","esri/dijit/BasemapGallery","dojo/_base/connect","dojo/on","dojo/query","dojo/_base/array","agsjs/dijit/TOC","dojo/dnd/move","dojo/dom","dojo/dom-construct","dojo/parser","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojo/domReady!"],function(e,t,r,i,a,n,o,s,l,d,m,c,p,u,y,g,f,S,b,w,v,h,E,I,T,L,R){function P(e){var t=n.webMercatorToGeographic(e.mapPoint);T.byId("info").innerHTML="Latitude: "+t.x.toFixed(3)+", Longitude: "+t.y.toFixed(3)}function A(){var e=new S({showArcGISBasemaps:!0,map:map},"basemapGallery");e.startup(),e.on("error",function(e){console.log("basemap gallery error:  ",e)})}function C(){visible=[];for(var e=0;e<toc.layerInfos[3].layer._tocInfos.length;e++){var t=toc.layerInfos[3].layer._tocInfos[e];t.visible===!0&&visible.push(t.id)}}R.parse(),geometryService=new a("http://recover.giscenter.isu.edu/arcgis/rest/services/Utilities/Geometry/GeometryServer"),esriConfig.defaults.geometryService="http://recover.giscenter.isu.edu/arcgis/rest/services/Utilities/Geometry/GeometryServer",widgets.forEach(function(e){new I.parentConstrainedMoveable(e.widget,{handle:e.handle,area:map,within:!0,delay:"20px"});e.handle.addEventListener("mousedown",function(){$(this).parent().css("opacity","0.6")}),e.handle.addEventListener("mouseup",function(){$(this).parent().css("opacity","1")})}),window.onkeydown=function(e){if(112===e.keyCode){var t=window.open("http://giscenter.isu.edu/research/Techpg/nasa_RECOVER/index.htm","_blank");t?t.focus():alert("Please allow popups for this website")}},startExtent=esri.geometry.Extent(-12692442.57378805,5316630.715935899,-12496763.781377923,5389245.892806845,new i({wkid:102100})),map=new e("map",{extent:startExtent,zoom:10,basemap:"satellite",infoWindow:popup}),window.map=map,baseLyrs=new r("http://fuji.giscenter.isu.edu/arcgis/rest/services/RECOVER_crystalFire_ID/basemap/MapServer"),FireSeverity=new t("http://services1.arcgis.com/z5tlnpYHokW9isdE/arcgis/rest/services/RECOVER_RT/FeatureServer/0"),FireLine=new t("http://services1.arcgis.com/z5tlnpYHokW9isdE/arcgis/rest/services/RECOVER_RT/FeatureServer/2"),FireRecords=new t("http://services1.arcgis.com/z5tlnpYHokW9isdE/arcgis/rest/services/RECOVER_RT/FeatureServer/1"),map.on("load",function(){map.addLayers([FireSeverity,FireRecords,FireLine,baseLyrs])}),layers.push(baseLyrs),map.on("layers-add-result",function(e){toc=new E({map:map,layerInfos:[{layer:FireSeverity,title:"Fire Severity",slider:!0,collapsed:!0},{layer:FireRecords,title:"Fire Records",slider:!0,collapsed:!0},{layer:FireLine,title:"Fire Line",slider:!0,collapsed:!0},{layer:baseLyrs,title:"RECOVER Base Layers",collapsed:!0,slider:!0}]},"tocDiv"),toc.startup()}),$("#tocDiv").on("change",C),popup=new y({fillSymbol:new m(m.STYLE_SOLID,new c(c.STYLE_SOLID,new p([255,0,0]),2),new p([255,255,0,.25]))},L.create("div"));new u({map:map,scalebarUnit:"dual"});A();var k=new g({map:map,attachTo:"bottom-right",color:"#F20C0C",opacity:.4});k.startup(),map.on("load",function(){map.graphics.graphics.pop(),map.on("mouse-move",P),map.on("mouse-drag",P)})}),$("#map").ready(function(){setInterval(e,1500)}),$(document).ready(function(){$("#GSCCModal").modal({backdrop:"static"}),$("#GSCCModal").css({display:"block"})}),$("#close_modal").on("click",function(){$("body").removeClass("modal-open"),$(".modal-backdrop.in").remove(),$("#GSCCModal").remove()}),widgets=[{name:"LayerList",icon:$("#LyrListImg"),widget:document.getElementById("LyrWidget"),handle:document.getElementById("LyrListTitle")},{name:"Swipe",icon:$("#SwipeImg"),widget:document.getElementById("SwipeWidget"),handle:document.getElementById("SwipeTitle")},{name:"Draw",icon:$("#DrawImg"),widget:document.getElementById("DrawWidget"),handle:document.getElementById("DrawTitle")},{name:"Bookmarks",icon:$("#BookmarkImg"),widget:document.getElementById("BookmarksWidget"),handle:document.getElementById("BookmarkTitle")},{name:"Shapefile",icon:$("#ShpImg"),widget:document.getElementById("ShpWidget"),handle:document.getElementById("ShpfileTitle")},{name:"Print",icon:$("#PrintImg"),widget:document.getElementById("PrintWidget"),handle:document.getElementById("PrintTitle")}],widgets.forEach(function(e){e.icon.on("click",function(){$(this).toggleClass("selected"),$(this).animate({bottom:"10px"},200),$(this).animate({bottom:"0px"},200),e.icon.hasClass("selected")?e.widget.style.display="block":e.widget.style.display="none"}),$(e.widget).on("click","button.remove",function(){$(this).closest(".widget_container").hide(),e.icon.removeClass("selected")}).removeClass("selected"),$(e.widget).on("click","button.minimize",function(){var e=$(this).closest(".widget_container");e.toggleClass("minimized"),e.hasClass("minimized")?$(this).find("img").attr("src","assets/images/w_down.png"):$(this).find("img").attr("src","assets/images/w_min.png")})})}(),function(){require(["esri/InfoTemplate","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","dojo/_base/array","dojo/domReady!"],function(e,t,r,i){function a(){$("#DrawImg").hasClass("selected")===!0?(s.returnGeometry=!1,$(".esriPopup").hide()):(map.on("click",n),s.layerIds=visible,s.layerOption=r.LAYER_OPTION_ALL,s.tolerance=3,s.width=map.width,s.height=map.height,s.returnGeometry=!0,$(".esriPopup").show())}function n(t){s.geometry=t.mapPoint,s.mapExtent=map.extent;var r=o.execute(s).addCallback(function(t){return i.map(t,function(t){var r=t.feature,i=t.layerName;if(r.attributes.layerName=i,"Fire Boundary"===i){var a=new e("Fire Boundary","Fire Number: ${FIRE_NUMBE}<br>Year: ${YEAR_}");r.setInfoTemplate(a)}if("Roads"===i){var n=new e("Roads","Class: ${ROAD_CL}<br>Length: ${Shape_Length}");r.setInfoTemplate(n)}if("NHD (National Hydrography Dataset)"===i){var o=new e("Hydrography","FCode: ${FCode}<br>Feature Type: ${FType}<br>Length: ${Shape_Length}");r.setInfoTemplate(o)}if("Habitat"===i){var s=new e("Habitat","Notes: ${Notes}<br>Species: ${Species}<br>Area (sq. Meters): ${SHAPE_Area}");r.setInfoTemplate(s)}if("WatershedsWBD"===i){var l=new e("Watershed Boundary","Name: ${Watershed Name}<br>Acres: ${Acres}<br>");r.setInfoTemplate(l)}if("Wetlands"===i){var d=new e("Wetlands","Type: ${WetlandType}<br>Length (meters): ${Shape_Length}<br>Area (sq. meters): ${Shape_area}<br>Acres: ${ACRES}");r.setInfoTemplate(d)}if("PLSS"===i){var m=new e("PLSS","Identifier: ${FRSTDIVID}<br>State: ${STATE}<br>Section: ${DivNumber}<br>Type: ${DivType}<br>Township: ${TOWNSHIP}<br>Range: ${RANGE}");r.setInfoTemplate(m)}if("SMA (Surface Management Agency)"===i){var c=new e("Surface Management Agency","Admin Department: ${Administration Department}<br>Admin Agency: ${Administration Agency}<br>Unit Name: ${Admin. Unit Name}");r.setInfoTemplate(c)}if("Geology"===i){var p=new e("Geology","State: ${STATE}<br>Age: ${UNIT_AGE}<br>LITH62: ${LITH62}<br>LITH62MINO: ${LITH62MINO}<br><br> Attachment:<br><a href=${URL} target=_blank>Site Description Report</a");r.setInfoTemplate(p)}if("Soils_STATSGO"===i){var u=new e("Soils STATSGO","Map Unit Symbol: ${MUSYM}<br>MUKEY: ${MUKEY}<br><br>Attachment:<br><a href=${URL} target=_blank>Range Report</a>");r.setInfoTemplate(u)}if("Soils_SSURGO"===i){var y=new e("Soils SSURGO","Area Symbol: ${AREASYMBOL}<br>Map Unit Symbol: ${MUSYM}<br><br>Attachment:<br><a href=${URL} target=_blank>Plant Association Report</a>");r.setInfoTemplate(y)}if("Landslide Potential"===i){var g=new e("Landslide Potential","Susceptibility: ${INC_SUS}");r.setInfoTemplate(g)}if("Fires 1950-Present"===i){var f=new e("Fires 1950-Present","Name: ${FIRE_NAME}<br>Year: ${FIRE_YEAR}<br>Acres: ${Acres}");r.setInfoTemplate(f)}if("Elevation"===i){var S=new e("Elevation","Value (Meters): ${Pixel Value}");r.setInfoTemplate(S)}if("Slope (Degrees)"===i){var b=new e("Slope (Degrees)","Value: ${Pixel Value}");r.setInfoTemplate(b)}if("Slope (Percent)"===i){var w=new e("Slope (Percent)","Value: ${Pixel Value}");r.setInfoTemplate(w)}if("Aspect"===i){var v=new e("Aspect","Value: ${Pixel Value}");r.setInfoTemplate(v)}if("FRG (Fire Regime Group)"===i){var h=new e("FRG (Fire Regime Group)","Label: ${Label}<br>Description: ${Descriptio}");r.setInfoTemplate(h)}if("EVC (Existing Vegetation Coverage)"===i){var E=new e("EVC (Existing Vegetation Coverage)","Class: ${CLASSNAMES}");r.setInfoTemplate(E)}if("EVT (Existing Vegetation Type)"===i){var I=new e("EVT (Existing Vegetation Type)","Class Name: ${CLASSNAME}<br>EVT Phys: ${EVT_PHYS}<br>System Group Name: ${EVT_GP_N}<br>SAF SRM: ${SAF_SRM}<br>EVT Order: ${EVT_ORDER}<br>EVT Subclass: ${EVT_SBCLS}");r.setInfoTemplate(I)}if("ESP (Environmental Site Potential)"===i){var $=new e("ESP (Environmental Site Potential)","Zone: ${ZONE_NAME}<br>ESP NAME: ${ESP_Name}<br>ESPLF NAME: ${ESPLF_Name}");r.setInfoTemplate($)}if("BPS (Biophysical Setting)"===i){var T=new e("BPS (Biophysical Setting)","NAME: ${BPS_NAME}<br>Group Name: ${GROUPNAME}<br>Group Vegetation Type: ${GROUPVEG}");r.setInfoTemplate(T)}return r})});map.infoWindow.setFeatures([r]),map.infoWindow.show(t.mapPoint)}var o=new t("http://fuji.giscenter.isu.edu/arcgis/rest/services/RECOVER_crystalFire_ID/basemap/MapServer"),s=new r;$("#map").on("click",a),$("#CloseDrawWidget").on("click",function(){$(".esriPopup .titleButton.close").click()})})}(),function(){require(["esri/dijit/BookmarkItem","esri/dijit/Bookmarks","dojo/dom","dojo/domReady!"],function(e,t,r,i){function a(){var e=[{extent:startExtent,name:"Crystal Fire"}];new t({map:map,bookmarks:e,editable:!0},dojo.byId("Bookmarks"))}dojo.ready(a)})}(),function(){require(["esri/dijit/LayerSwipe","dojo/_base/array","esri/arcgis/utils","dojo/dom","dojo/on","dojo/domReady!"],function(e,t,r,i,a){function n(){s.destroy(),$("#map").prepend(o),$(".esriSimpleSlider").show()}var o=document.createElement("div");o.id="swipeDiv";var s,l=screen.width/2;$("#SwipeImg").on("click",function(){$("#SwipeImg").hasClass("selected")===!0?(s=new e({theme:"LayerSwipe",type:"vertical",map:map,layers:layers,left:l,invertPlacement:!0},"swipeDiv"),s.startup(),$(".esriSimpleSlider").hide(),$(".esriPopup").hide()):n()}),$("#CloseSwipeWidget").on("click",n),a(i.byId("toggleVertical"),"click",function(e){s.set("type","vertical"),$(".LayerSwipe").css("top","0")}),a(i.byId("toggleHorizontal"),"click",function(e){s.set("type","horizontal"),$(".LayerSwipe").css("top","auto")})})}(),function(){require(["esri/config","esri/InfoTemplate","esri/map","esri/request","esri/geometry/scaleUtils","esri/layers/FeatureLayer","esri/renderers/SimpleRenderer","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","dojo/dom","dojo/json","dojo/on","dojo/parser","dojo/sniff","dojo/_base/array","esri/Color","dojo/_base/lang","dijit/layout/BorderContainer","dijit/layout/ContentPane","dojo/domReady!"],function(e,t,r,i,a,n,o,s,l,d,m,c,p,u,y,g,f,S){function b(e){function r(e){m.byId("upload-status").innerHTML="<p style='color:red'>"+e.message+"</p>"}function p(e){var r;g.forEach(e.layers,function(e){var i=new t("Details","${*}"),a=new n(e,{infoTemplate:i});a.on("click",function(e){map.infoWindow.setFeatures([e.graphic])}),u(a),r=r?r.union(a.fullExtent):a.fullExtent,layers.push(a)}),map.addLayers(layers),map.setExtent(r.expand(1.25),!0),m.byId("upload-status").innerHTML=""}function u(e){var t=null;switch(e.geometryType){case"esriGeometryPoint":t=new s({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Shapes/BluePin1LargeB.png",contentType:"image/png",width:20,height:20});break;case"esriGeometryPolygon":t=new l(l.STYLE_SOLID,new d(d.STYLE_SOLID,new f([255,0,0]),4),new f([255,255,255,.5]))}t&&e.setRenderer(new o(t))}var y=e.split(".");y=y[0].replace("c:\\fakepath\\",""),m.byId("upload-status").innerHTML="<b>Loading </b>"+y;var b={name:y,targetSR:map.spatialReference,maxRecordCount:1e3,enforceInputFileSizeLimit:!0,enforceOutputJsonSizeLimit:!0},v=a.getExtentForScale(map,4e4),h=v.getWidth()/map.width;b.generalize=!0,b.maxAllowableOffset=h,b.reducePrecision=!0,b.numberOfDigitsAfterDecimal=0;var E={filetype:"shapefile",publishParameters:c.stringify(b),f:"json"};i({url:w+"/sharing/rest/content/features/generate",content:E,form:m.byId("uploadForm"),handleAs:"json",load:S.hitch(this,function(e){if(e.error)return void r(e.error);var t=e.featureCollection.layers[0].layerDefinition.name;m.byId("upload-status").innerHTML="<b>Loaded: </b>"+t,p(e.featureCollection)}),error:S.hitch(this,r)})}u.parse();var w="http://www.arcgis.com";p(m.byId("uploadForm"),"change",function(e){var t=e.target.value.toLowerCase();if(y("ie")){var r=t.split("\\");t=r[r.length-1]}-1!==t.indexOf(".zip")?b(t):m.byId("upload-status").innerHTML='<p style="color:red">Add shapefile as .zip file</p>'})})}(),function(){var e={};require(["esri/config","esri/tasks/GeometryService","esri/tasks/PrintTask","esri/tasks/PrintParameters","esri/tasks/PrintTemplate","dojo/_base/array","dojo/dom","dojo/on","dojo/parser","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dijit/form/CheckBox","dojo/domReady!"],function(t,r,i,a,n,o,s,l,d){function m(t,r){var o=new n;o.layout=document.getElementById("printLayoutId").value,o.format=document.getElementById("printFormatId").value,o.layoutOptions={titleText:t,authorText:r};var s=new a;s.map=map,s.template=o;var l=new i(e.printUrl),d={printTask:l,params:s};return d}e.printUrl="http://fuji.giscenter.isu.edu/arcgis/rest/services/RECOVER/ExportWebMap/GPServer/Export%20Web%20Map",l(s.byId("btnPrintReady"),"click",function(){document.getElementById("btnPrintReady").innerHTML="Printing...",document.getElementById("btnPrintReady").disabled=!0;var e=m(document.getElementById("printTitleId").value,document.getElementById("printAuthor").value),t=e.printTask;t.execute(e.params,function(e){window.open(e.url),document.getElementById("btnPrintReady").innerHTML="Print",document.getElementById("btnPrintReady").disabled=!1})})})}();